<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SafeSakhi â€“ Emergency Help</title>
  <link rel="icon" href="safesakhi-icon.png">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff5f5;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #c2185b;
    }
    button {
      font-size: 20px;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      margin: 10px;
      color: white;
      cursor: pointer;
    }
    #sosButton {
      background-color: #d32f2f;
    }
    #whatsappButton {
      background-color: #388e3c;
    }
    #howItWorks {
      margin-top: 20px;
      font-weight: bold;
      color: #ad1457;
    }
  </style>
</head>
<body>

  <h1>ðŸš¨ SafeSakhi Emergency Help</h1>
  <p>Press the SOS button or say <strong>"Help me"</strong> to trigger alert.</p>

  <button id="sosButton">ðŸ“¢ SOS â€“ Help Me!</button><br>
  <button id="whatsappButton">ðŸ“² Send SOS via WhatsApp</button>

  <p id="howItWorks">ðŸ“˜ How SafeSakhi Works</p>

  <audio id="beepSound" src="https://www.soundjay.com/buttons/beep-07.wav" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/sound@0.8/dist/teachablemachine-sound.min.js"></script>

  <script>
    let locationText = '';
    let beepSound = document.getElementById("beepSound");

    // Get location
    function fetchLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          locationText = `My location: https://www.google.com/maps?q=${lat},${lon}`;
        });
      } else {
        locationText = "Location not available.";
      }
    }

    fetchLocation();

    // SOS Alert
    document.getElementById("sosButton").addEventListener("click", function () {
      beepSound.play();
      alert("SOS Triggered! Sending alert...");
      try {
        // Flashlight (only works in Android app with WebView + JSInterface)
        if (navigator.userAgent.includes("Android")) {
          Android.toggleFlashlight(); // You must define this in Android WebView
        }
      } catch (e) {}
    });

    // WhatsApp SOS
    document.getElementById("whatsappButton").addEventListener("click", function () {
      const message = encodeURIComponent("ðŸš¨ Emergency! I need help. " + locationText);
      window.open("https://wa.me/?text=" + message, "_blank");
    });

    // Voice Command (Web Speech API)
    if ('webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.lang = 'en-US';
      recognition.start();

      recognition.onresult = function (event) {
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            const transcript = event.results[i][0].transcript.trim().toLowerCase();
            if (transcript.includes("help me")) {
              document.getElementById("sosButton").click();
            }
          }
        }
      };
    }

    // Teachable Machine Scream Detection
    const URL = "https://teachablemachine.withgoogle.com/models/YOUR_MODEL_URL/";
    let model, mic;

    async function initTeachable() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmSound.load(modelURL, metadataURL);
      mic = new tmSound.Audio();
      await mic.setup();
      loop();
    }

    async function loop() {
      await mic.play();
      setInterval(async () => {
        const prediction = await model.predict(mic);
        const scream = prediction.find(p => p.className === "Scream" && p.probability > 0
