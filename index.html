<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SafeSakhi — SOS</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #fff5f5;
    }
    h1 {
        color: red;
    }
    button {
        padding: 15px;
        font-size: 18px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        width: 80%;
    }
    #activate { background-color: #d32f2f; }
    #stop { background-color: #424242; }
    #flash { background-color: #fbc02d; color: black; }
    #share { background-color: #e57373; }
    .status {
        margin-top: 15px;
        text-align: left;
    }
</style>
</head>
<body>

<h1>🚨 SafeSakhi — SOS</h1>
<p>Tap <b>Activate SOS</b> to play alarm, fetch location, and open WhatsApp with a prefilled emergency message.</p>

<button id="activate">📢 Activate SOS</button>
<button id="stop">⛔ Stop Alarm</button>
<button id="flash">💡 Flashlight Blink</button>
<button id="share">📍 Share Location Only</button>

<div class="status">
    📌 Location: <span id="locationStatus">Not fetched</span><br>
    🔴 SOS: <span id="sosStatus">Inactive</span><br>
</div>

<audio id="alarmSound" loop>
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA... (BASE64 ALARM SOUND HERE) ..." type="audio/mp3">
</audio>

<script>
let alarm = document.getElementById('alarmSound');
let blinkInterval;
let sosActive = false;

// Play alarm
function startAlarm() {
    alarm.play().catch(e => console.log("Sound error:", e));
}

// Stop alarm
function stopAlarm() {
    alarm.pause();
    alarm.currentTime = 0;
    clearInterval(blinkInterval);
    turnFlashlight(false);
    sosActive = false;
    document.getElementById("sosStatus").innerText = "Inactive";
}

// Flashlight control
async function turnFlashlight(on) {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        const track = stream.getVideoTracks()[0];
        await track.applyConstraints({ advanced: [{ torch: on }] });
    } catch (e) {
        console.log("Flashlight error:", e);
    }
}

function blinkFlashlight() {
    let on = false;
    blinkInterval = setInterval(() => {
        on = !on;
        turnFlashlight(on);
    }, 500);
}

// Location + WhatsApp
function sendLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            let lat = pos.coords.latitude;
            let lon = pos.coords.longitude;
            document.getElementById("locationStatus").innerText = `${lat}, ${lon}`;
            let message = `🚨 HELP! I am in danger. My location: https://maps.google.com/?q=${lat},${lon}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }, err => {
            alert("Location access denied.");
        });
    } else {
        alert("Geolocation not supported.");
    }
}

// Button actions
document.getElementById("activate").addEventListener("click", () => {
    startAlarm();
    blinkFlashlight();
    sendLocation();
    sosActive = true;
    document.getElementById("sosStatus").innerText = "Active";
});

document.getElementById("stop").addEventListener("click", stopAlarm);
document.getElementById("flash").addEventListener("click", blinkFlashlight);
document.getElementById("share").addEventListener("click", sendLocation);
</script>

</body>
    </html>
