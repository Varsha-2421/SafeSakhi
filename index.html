<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SafeSakhi â€” Offline SOS</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; background: #fff3f3; padding: 20px; }
    h1 { color: #d60000; }
    button { padding: 15px 25px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; margin: 10px; }
    #sosBtn { background: #d60000; color: white; }
    #stopBtn { background: #555; color: white; display: none; }
    .status { margin-top: 15px; font-weight: bold; }
</style>
</head>
<body>

<h1>ðŸš¨ SafeSakhi â€” SOS</h1>
<p>Tap Activate SOS to play alarm, turn on flashlight, get location, and send SMS.</p>

<button id="sosBtn">ðŸš¨ Activate SOS</button>
<button id="stopBtn">ðŸ›‘ Stop SOS</button>

<div class="status" id="statusMsg">Idle</div>

<script>
let alarmSound, track;

// Start SOS
document.getElementById("sosBtn").addEventListener("click", async () => {
    document.getElementById("statusMsg").innerText = "SOS Activated!";
    document.getElementById("sosBtn").style.display = "none";
    document.getElementById("stopBtn").style.display = "inline-block";

    // Play alarm sound
    try {
        alarmSound = new Audio("alarm.mp3");
        alarmSound.loop = true;
        await alarmSound.play();
    } catch (err) {
        alert("Turn off silent mode & tap again to allow sound.");
    }

    // Turn on flashlight
    try {
        let camStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        track = camStream.getVideoTracks()[0];
        await track.applyConstraints({ advanced: [{ torch: true }] });
    } catch (err) {
        console.warn("Flashlight not supported", err);
    }

    // Get location and send SMS
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            let lat = pos.coords.latitude.toFixed(5);
            let lon = pos.coords.longitude.toFixed(5);
            let message = encodeURIComponent(`Help me! I am in danger. My location: https://maps.google.com/?q=${lat},${lon}`);
            // Replace +911234567890 with your emergency number
            window.location.href = `sms:+911234567890?body=${message}`;
        }, err => {
            alert("Location access denied, SMS will not have coordinates.");
            window.location.href = `sms:+911234567890?body=${encodeURIComponent("Help me! I am in danger.")}`;
        });
    }
});

// Stop SOS
document.getElementById("stopBtn").addEventListener("click", () => {
    document.getElementById("statusMsg").innerText = "SOS Stopped";
    document.getElementById("sosBtn").style.display = "inline-block";
    document.getElementById("stopBtn").style.display = "none";

    if (alarmSound) { alarmSound.pause(); alarmSound.currentTime = 0; }
    if (track) { track.stop(); }
});
</script>
</body>
</html>
